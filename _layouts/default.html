<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Meta Description - Page specific or default -->
    <meta name="description" content="{{ page.description | default: site.description }}">

    <meta property="og:title" content="{{ site.og_title }}">
    <meta property="og:description" content="{{ site.og_description }}">
    <meta property="og:url" content="{{ site.url }}{{ page.url }}">
    <meta property="og:image" content="{{ site.url }}{{ site.og_image }}">
    <meta property="og:image:type" content="{{ site.og_image_type }}">
    <meta property="og:image:width" content="{{ site.og_image_width }}">
    <meta property="og:image:height" content="{{ site.og_image_height }}">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="{{ site.twitter_card }}">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ page.url | absolute_url }}">

    <!-- Page title -->
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>

    <!-- Meta description -->
{% assign meta_desc = page.description | default: site.description %}
    <meta name="description"
      content="{{ site.author.job_title }} at {{ site.author.affiliation_short }}. {{ meta_desc }}">
    <link rel="icon" type="image/svg+xml" href="{{ site.url }}/assets/logos/favicon.svg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/assets/css/style.css?v={{ site.time | date: '%s' }}">

    {% if site.google_analytics %}
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '{{ site.google_analytics }}');
    </script>
    {% endif %}

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "{{ site.author.name }}",
      "alternateName": "{{ site.author.alternate_name }}",
      "givenName": "{{ site.author.given_name }}",
      "familyName": "{{ site.author.family_name }}",
      "jobTitle": "{{ site.author.job_title }}",
      "description": "{{ site.description }}",
      "knowsAbout": [
        {% for topic in site.schema.knowsAbout %}
        { "@type": "Thing", "name": "{{ topic }}" }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ],
      "affiliation": {
        "@type": "Organization",
        "name": "{{ site.author.affiliation }}",
        "url": "{{ site.author.affiliation_url }}"
      },
      "alumniOf": [
        {% for school in site.schema.alumni_of %}
        { "@type": "CollegeOrUniversity", "name": "{{ school.name }}" }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ],
      "email": "{{ site.author.email }}",
      "url": "{{ site.url }}",
      "sameAs": [
        "{{ site.social.linkedin }}",
        "{{ site.social.google_scholar }}",
        "{{ site.social.goodreads }}"
      ]
    }
    </script>
    <!-- Dark Mode Flash Prevention -->
    <script>
        (function() {
            // Check if user has explicitly chosen a theme
            const savedTheme = localStorage.getItem('theme');
            
            // If they chose dark mode before, apply it
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                // Default to light mode (ignore system preference)
                document.documentElement.setAttribute('data-theme', 'light');
            }
        })();
    </script>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <img src="/assets/profile_picture.webp" alt="{{ site.author.name }}" class="profile-img js-spin-trigger">
            <div class="name">{{ site.author.name }}</div>
            <div class="affiliation">PhD Candidate<br>{{ site.author.affiliation_short }}</div>
{% assign current = page.url %}
{% for item in site.data.navigation %}
  <a href="{{ item.url | relative_url }}"
     class="sidebar-btn {% if current == item.url %}btn-active{% else %}btn-outline{% endif %}">
    {{ item.title }}
  </a>
{% endfor %}
            <a href="mailto:{{ site.author.email }}" class="sidebar-btn btn-primary">Email Me</a>
            <div class="social-links">
                <!-- LinkedIn -->
                <a href="{{ site.social.linkedin }}" class="social-link" title="LinkedIn" target="_blank" rel="noopener">
                    <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                    </svg>
                </a>
                
                <!-- Google Scholar -->
                <a href="{{ site.social.google_scholar }}" class="social-link" title="Google Scholar" target="_blank" rel="noopener">
                    <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M5.242 13.769L0 9.5 12 0l12 9.5-5.242 4.269C17.548 11.249 14.978 9.5 12 9.5c-2.977 0-5.548 1.748-6.758 4.269zM12 10a7 7 0 1 0 0 14 7 7 0 0 0 0-14z"/>
                    </svg>
                </a>
                <!-- Book with special outline class -->
                <a href="{{ site.social.goodreads }}" class="social-link" title="Goodreads" target="_blank" rel="noopener">
                    <svg class="social-icon-outline" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                </a>
                <!-- Last.fm - Headphones -->
                <a href="{{ site.social.lastfm }}" class="social-link" title="Last.fm" target="_blank" rel="noopener">
                    <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 1c-4.97 0-9 4.03-9 9v7c0 1.66 1.34 3 3 3h3v-8H5v-2c0-3.87 3.13-7 7-7s7 3.13 7 7v2h-4v8h3c1.66 0 3-1.34 3-3v-7c0-4.97-4.03-9-9-9z"/>
                    </svg>
                </a>
            </div>
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
                <svg class="theme-icon theme-icon-sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="theme-icon theme-icon-moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </aside>

        <main class="content">
            {{ content }}
        </main>
    </div>

    {% include footer.html %}
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            
            /* --- 1. SPINNING PROFILE PICTURE --- */
            const profilePic = document.querySelector('.js-spin-trigger');
            if (profilePic) {
                const SPIN_DURATION = 3200;
                profilePic.style.cursor = "pointer";
                profilePic.addEventListener('click', function() {
                    profilePic.classList.add('spin-effect');
                    setTimeout(() => {
                        profilePic.classList.remove('spin-effect');
                    }, SPIN_DURATION);
                });
            }
    
            /* --- 2. FAMILY DYNAMIC MODAL WITH ACCESSIBILITY --- */
            const modal = document.getElementById('family-modal');
            const modalImg = document.getElementById('modal-img');
            const modalCaption = document.getElementById('modal-caption');
            const closeButton = document.getElementById('modal-close');
            const triggers = document.querySelectorAll('.family-link');
    
            // Family data from Jekyll data file
            const familyData = {{ site.data.family | jsonify }};
    
            if (modal && triggers.length > 0 && familyData) {
                let lastFocusedElement = null;
    
                // Function to open modal
                const openModal = (personKey) => {
                    const personData = familyData[personKey];
                    if (!personData) return;
    
                    // Store the element that opened the modal
                    lastFocusedElement = document.activeElement;
    
                    // Set modal content
                    modalImg.src = personData.img;
                    modalImg.alt = personData.text;
                    modalCaption.innerText = personData.text;
    
                    // Show modal
                    modal.style.display = 'flex';
                    modal.setAttribute('aria-hidden', 'false');
    
                    // Focus the close button
                    if (closeButton) {
                        closeButton.focus();
                    }
    
                    // Prevent body scroll
                    document.body.style.overflow = 'hidden';
                };
    
                // Function to close modal
                const closeModal = () => {
                    modal.style.display = 'none';
                    modal.setAttribute('aria-hidden', 'true');
    
                    // Restore body scroll
                    document.body.style.overflow = '';
    
                    // Clear the image to prevent flash on next open
                    modalImg.src = '';
                    modalImg.alt = '';
                    modalCaption.innerText = '';
    
                    // Return focus to the element that opened the modal
                    if (lastFocusedElement) {
                        lastFocusedElement.focus();
                    }
                };
    
                // Add click and keyboard support to triggers
                triggers.forEach(trigger => {
                    trigger.setAttribute('role', 'button');
                    trigger.setAttribute('tabindex', '0');
                    trigger.setAttribute('aria-haspopup', 'dialog');
    
                    // Click event
                    trigger.addEventListener('click', function(e) {
                        e.preventDefault();
                        const personKey = this.getAttribute('data-person');
                        openModal(personKey);
                    });
    
                    // Keyboard event (Enter or Space)
                    trigger.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            const personKey = this.getAttribute('data-person');
                            openModal(personKey);
                        }
                    });
                });
    
                // Close button click
                if (closeButton) {
                    closeButton.addEventListener('click', closeModal);
                }
    
                // Click outside modal content to close
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeModal();
                    }
                });
    
                // Escape key to close
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && modal.style.display === 'flex') {
                        closeModal();
                    }
                });
    
                // Focus trap inside modal
                modal.addEventListener('keydown', function(e) {
                    if (e.key === 'Tab') {
                        const focusableElements = modal.querySelectorAll(
                            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                        );
                        
                        if (focusableElements.length === 0) return;
                        
                        const firstElement = focusableElements[0];
                        const lastElement = focusableElements[focusableElements.length - 1];
    
                        if (e.shiftKey) {
                            // Shift + Tab
                            if (document.activeElement === firstElement) {
                                e.preventDefault();
                                lastElement.focus();
                            }
                        } else {
                            // Tab
                            if (document.activeElement === lastElement) {
                                e.preventDefault();
                                firstElement.focus();
                            }
                        }
                    }
                });
            }
    
            /* --- 3. DARK MODE TOGGLE --- */
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                // Get current theme
                const getCurrentTheme = () => {
                    return document.documentElement.getAttribute('data-theme') || 'light';
                };
                
                // Set theme
                const setTheme = (theme) => {
                    document.documentElement.setAttribute('data-theme', theme);
                    localStorage.setItem('theme', theme);
                    
                    // Update button aria-label
                    if (theme === 'dark') {
                        themeToggle.setAttribute('aria-label', 'Switch to light mode');
                        themeToggle.setAttribute('title', 'Switch to light mode');
                    } else {
                        themeToggle.setAttribute('aria-label', 'Switch to dark mode');
                        themeToggle.setAttribute('title', 'Switch to dark mode');
                    }
                };
                
                // Toggle theme
                themeToggle.addEventListener('click', () => {
                    const currentTheme = getCurrentTheme();
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    setTheme(newTheme);
                });
                
                // Set initial aria-label
                const initialTheme = getCurrentTheme();
                if (initialTheme === 'dark') {
                    themeToggle.setAttribute('aria-label', 'Switch to light mode');
                    themeToggle.setAttribute('title', 'Switch to light mode');
                }
            }
    
        });
    
        // Console Easter Egg
        console.log(
            "%cðŸ‘‹ Hi, I'm {{ site.author.given_name }}.\n%cInterested in my code? Check out the repo: {{ site.social.github }}",
            "color: #2774AE; font-size: 20px; font-weight: bold; font-family: sans-serif;",
            "color: #64748b; font-size: 12px; font-family: sans-serif;"
        );
    </script>
</body>
</html>
