<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Meta Description - Page specific or default -->
    <meta name="description" content="{{ page.description | default: 'PhD Candidate at UCLA Anderson researching the human supply chain of AI, crowdwork platforms, and algorithmic fairness.' }}">
    
    <meta property="og:title" content="Martin Gonzalez Cabello">
    <meta property="og:description" content="PhD Candidate in Operations & Technology Management at UCLA Anderson. Researching the human supply chain of AI and crowdwork platforms.">
    <meta property="og:url" content="https://martin.gonzalezcabello.com{{ page.url }}">
    <meta property="og:image" content="https://martin.gonzalezcabello.com/assets/social_preview.jpg">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    
    <title>{{ page.title }} | Martin Gonzalez Cabello</title>
    <link rel="icon" type="image/svg+xml" href="https://martin.gonzalezcabello.com/assets/favicon.svg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="/assets/css/style.css?v={{ site.time | date: '%s' }}">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SKK42FETN2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-SKK42FETN2');
    </script>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Martin Gonzalez Cabello",
      "jobTitle": "PhD Candidate",
      "affiliation": { "@type": "Organization", "name": "UCLA Anderson School of Management" },
      "alumniOf": [
        { "@type": "CollegeOrUniversity", "name": "MIT Sloan School of Management" },
        { "@type": "CollegeOrUniversity", "name": "Universidad PolitÃ©cnica de Madrid" }
      ],
      "url": "https://martin.gonzalezcabello.com",
      "sameAs": [
        "https://www.linkedin.com/in/martingc/",
        "https://scholar.google.com/citations?user=5OSLJwQAAAAJ"
      ]
    }
    </script>
    <script>
    // Dark Mode Toggle - runs before page loads to prevent flash
    (function() {
        // Check localStorage for saved theme preference
        const savedTheme = localStorage.getItem('theme');
        
        // If user has a saved preference, apply it immediately
        if (savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
        }
    })();
    </script>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <img src="/assets/profile_picture.webp" alt="Martin Gonzalez Cabello" class="profile-img js-spin-trigger">
            <h1 class="name">Martin Gonzalez Cabello</h1>
            <div class="affiliation">PhD Candidate<br>UCLA Anderson</div>

            <a href="index.html" class="sidebar-btn {% if page.active_page == 'home' %}btn-active{% else %}btn-outline{% endif %}">Home</a>
            <a href="teaching.html" class="sidebar-btn {% if page.active_page == 'teaching' %}btn-active{% else %}btn-outline{% endif %}">Teaching</a>
            <a href="cv.html" class="sidebar-btn {% if page.active_page == 'cv' %}btn-active{% else %}btn-outline{% endif %}">Curriculum Vitae</a>
            <a href="mailto:martin@gonzalezcabello.com" class="sidebar-btn btn-primary">Email Me</a>
            <!-- Replace your entire <div class="social-links"> section with this -->

            <div class="social-links">
                <!-- LinkedIn - Official logo -->
                <a href="https://www.linkedin.com/in/martingc/" class="social-link" title="LinkedIn" target="_blank" rel="noopener">
                    <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                </a>
                
                <!-- Google Scholar - Graduation cap -->
                <a href="https://scholar.google.com/citations?user=5OSLJwQAAAAJ" class="social-link" title="Google Scholar" target="_blank" rel="noopener">
                    <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M5.242 13.769L0 9.5 12 0l12 9.5-5.242 4.269C17.548 11.249 14.978 9.5 12 9.5c-2.977 0-5.548 1.748-6.758 4.269zM12 10a7 7 0 1 0 0 14 7 7 0 0 0 0-14z"/>
                    </svg>
                </a>
                
                <!-- Goodreads - Open book icon -->
                <a href="https://www.goodreads.com/user/show/29425606-mart-n-gonz-lez-cabello" class="social-link" title="Goodreads" target="_blank" rel="noopener">
                    <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                </a>
                
                <!-- Last.fm - Headphones icon -->
                <a href="https://www.last.fm/user/tinjr" class="social-link" title="Last.fm" target="_blank" rel="noopener">
                    <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                        <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
                    </svg>
                </a>
            </div>
            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
                <svg class="theme-icon theme-icon-sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="theme-icon theme-icon-moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
        </aside>

        <main class="content">
            {{ content }}
        </main>
    </div>

    {% include footer.html %}

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            
            /* --- 1. SPINNING PROFILE PICTURE --- */
            const profilePic = document.querySelector('.js-spin-trigger');
            if (profilePic) {
                const SPIN_DURATION = 3200;
                profilePic.style.cursor = "pointer";
                profilePic.addEventListener('click', function() {
                    profilePic.classList.add('spin-effect');
                    setTimeout(() => {
                        profilePic.classList.remove('spin-effect');
                    }, SPIN_DURATION);
            /* --- 3. DARK MODE TOGGLE --- */
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                // Get current theme
                const getCurrentTheme = () => {
                    return document.documentElement.getAttribute('data-theme') || 'light';
                };
                
                // Set theme
                const setTheme = (theme) => {
                    document.documentElement.setAttribute('data-theme', theme);
                    localStorage.setItem('theme', theme);
                    
                    // Update button aria-label
                    if (theme === 'dark') {
                        themeToggle.setAttribute('aria-label', 'Switch to light mode');
                        themeToggle.setAttribute('title', 'Switch to light mode');
                    } else {
                        themeToggle.setAttribute('aria-label', 'Switch to dark mode');
                        themeToggle.setAttribute('title', 'Switch to dark mode');
                    }
                };
                
                // Toggle theme
                themeToggle.addEventListener('click', () => {
                    const currentTheme = getCurrentTheme();
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    setTheme(newTheme);
                });
                
                // Set initial aria-label
                const initialTheme = getCurrentTheme();
                if (initialTheme === 'dark') {
                    themeToggle.setAttribute('aria-label', 'Switch to light mode');
                    themeToggle.setAttribute('title', 'Switch to light mode');
                }
            }
        });
            }

            /* --- 2. FAMILY DYNAMIC MODAL WITH ACCESSIBILITY --- */
            const modal = document.getElementById('family-modal');
            const modalImg = document.getElementById('modal-img');
            const modalCaption = document.getElementById('modal-caption');
            const closeButton = document.getElementById('modal-close');
            const triggers = document.querySelectorAll('.family-link');

            // Family data from Jekyll data file
            const familyData = {{ site.data.family | jsonify }};

            if (modal && triggers.length > 0 && familyData) {
                let lastFocusedElement = null;

                // Function to open modal
                const openModal = (personKey) => {
                    const personData = familyData[personKey];
                    if (!personData) return;

                    // Store the element that opened the modal
                    lastFocusedElement = document.activeElement;

                    // Set modal content
                    modalImg.src = personData.img;
                    modalImg.alt = personData.text;
                    modalCaption.innerText = personData.text;

                    // Show modal
                    modal.style.display = 'flex';
                    modal.setAttribute('aria-hidden', 'false');

                    // Focus the close button
                    if (closeButton) {
                        closeButton.focus();
                    }

                    // Prevent body scroll
                    document.body.style.overflow = 'hidden';
                };

                // Function to close modal
                const closeModal = () => {
                    modal.style.display = 'none';
                    modal.setAttribute('aria-hidden', 'true');

                    // Restore body scroll
                    document.body.style.overflow = '';

                    // Clear the image to prevent flash on next open
                    modalImg.src = '';
                    modalImg.alt = '';
                    modalCaption.innerText = '';

                    // Return focus to the element that opened the modal
                    if (lastFocusedElement) {
                        lastFocusedElement.focus();
                    }
                };

                // Add click and keyboard support to triggers
                triggers.forEach(trigger => {
                    trigger.setAttribute('role', 'button');
                    trigger.setAttribute('tabindex', '0');
                    trigger.setAttribute('aria-haspopup', 'dialog');

                    // Click event
                    trigger.addEventListener('click', function(e) {
                        e.preventDefault();
                        const personKey = this.getAttribute('data-person');
                        openModal(personKey);
                    });

                    // Keyboard event (Enter or Space)
                    trigger.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            const personKey = this.getAttribute('data-person');
                            openModal(personKey);
                        }
                    });
                });

                // Close button click
                if (closeButton) {
                    closeButton.addEventListener('click', closeModal);
                }

                // Click outside modal content to close
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeModal();
                    }
                });

                // Escape key to close
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && modal.style.display === 'flex') {
                        closeModal();
                    }
                });

                // Focus trap inside modal
                modal.addEventListener('keydown', function(e) {
                    if (e.key === 'Tab') {
                        const focusableElements = modal.querySelectorAll(
                            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                        );
                        
                        if (focusableElements.length === 0) return;
                        
                        const firstElement = focusableElements[0];
                        const lastElement = focusableElements[focusableElements.length - 1];

                        if (e.shiftKey) {
                            // Shift + Tab
                            if (document.activeElement === firstElement) {
                                e.preventDefault();
                                lastElement.focus();
                            }
                        } else {
                            // Tab
                            if (document.activeElement === lastElement) {
                                e.preventDefault();
                                firstElement.focus();
                            }
                        }
                    }
                });
            }
        });

        // Console Easter Egg
        console.log(
            "%cðŸ‘‹ Hi, I'm Martin.\n%cInterested in my code? Check out the repo: https://github.com/martins73/research-site",
            "color: #2774AE; font-size: 20px; font-weight: bold; font-family: sans-serif;",
            "color: #64748b; font-size: 12px; font-family: sans-serif;"
        );
    </script>
</body>
</html>
