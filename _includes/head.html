<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

{% assign meta_desc = page.description | default: site.description %}

<link rel="canonical" href="{{ page.url | absolute_url }}">

<title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>

<meta name="description" content="{{ site.author.job_title }} at {{ site.author.affiliation_short }}. {{ meta_desc }}">

<meta property="og:title" content="{{ page.title | default: site.og_title }}">
<meta property="og:description" content="{{ meta_desc }}">
<meta property="og:url" content="{{ page.url | absolute_url }}">
<meta property="og:image" content="{{ site.og_image | absolute_url }}">
<meta property="og:image:type" content="{{ site.og_image_type }}">
<meta property="og:image:width" content="{{ site.og_image_width }}">
<meta property="og:image:height" content="{{ site.og_image_height }}">
<meta property="og:type" content="website">

<meta name="twitter:card" content="{{ site.twitter_card }}">

<link rel="icon" type="image/svg+xml" href="{{ '/assets/logos/favicon.svg' | relative_url }}">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible:ital,wght@0,400;0,700;1,400;1,700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">

<link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}?v={{ site.time | date: '%s' }}">

{% if site.google_analytics %}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', '{{ site.google_analytics }}');
</script>
{% endif %}

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "{{ site.author.name }}",
  "alternateName": "{{ site.author.alternate_name }}",
  "givenName": "{{ site.author.given_name }}",
  "familyName": "{{ site.author.family_name }}",
  "jobTitle": "{{ site.author.job_title }}",
  "description": "{{ site.description }}",
  "knowsAbout": [
    {% for topic in site.schema.knowsAbout %}
    { "@type": "Thing", "name": "{{ topic }}" }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ],
  "affiliation": {
    "@type": "Organization",
    "name": "{{ site.author.affiliation }}",
    "url": "{{ site.author.affiliation_url }}"
  },
  "alumniOf": [
    {% for school in site.schema.alumni_of %}
    { "@type": "CollegeOrUniversity", "name": "{{ school.name }}" }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ],
  "email": "{{ site.author.email }}",
  "url": "{{ site.url }}",
  "sameAs": [
    "{{ site.social.linkedin }}",
    "{{ site.social.google_scholar }}",
    "{{ site.social.goodreads }}"
  ]
}
</script>

<!-- Dark Mode Flash Prevention -->
<script>
  (function() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      document.documentElement.setAttribute('data-theme', 'dark');
    } else {
      document.documentElement.setAttribute('data-theme', 'light');
    }
  })();
</script>

<!-- Mobile pre-paint scroll guard: prevents "jump up then down" on navigation -->
<script>
  (function () {
    const isMobile = window.matchMedia("(max-width: 768px)").matches;
    if (!isMobile) return;

    const shouldAutoScroll = sessionStorage.getItem("autoScrollToContent") === "1";
    if (!shouldAutoScroll) return;

    if ("scrollRestoration" in history) {
      history.scrollRestoration = "manual";
    }

    // Immediately scroll down to hide the top of the page
    // This prevents the flash of the profile picture before smooth scroll
    if (document.readyState === 'loading') {
      // If DOM is still loading, scroll as soon as it's ready
      document.addEventListener('DOMContentLoaded', function scrollOnLoad() {
        const main = document.getElementById("main-content");
        if (main) {
          const y = main.getBoundingClientRect().top + window.scrollY - 20;
          window.scrollTo({ top: y });
        }
        document.removeEventListener('DOMContentLoaded', scrollOnLoad);
      }, { once: true });
    } else {
      // If DOM is already loaded (shouldn't happen in head), scroll immediately
      const main = document.getElementById("main-content");
      if (main) {
        const y = main.getBoundingClientRect().top + window.scrollY - 20;
        window.scrollTo({ top: y });
      }
    }
  })();
</script>